#!/bin/bash
export THISDIR=$(pwd)
export SPECIESDIR=${THISDIR}/bin/Speciesfiles
export STRCDIR=${THISDIR}/bin/Strcfiles
export CASESDIR=${THISDIR}/Cases
if [[ ! -d ${SPECIESDIR} ]] ; then 
  echo "error in $0: incorrect directory"; exit 1 
fi
if [[ ! -d ${STRCDIR} ]] ; then 
   echo "error in $0: incorrect directory"; exit 1 
fi
if [[ ! -d ${CASESDIR} ]] ; then mkdir ${CASESDIR} ; fi
#
for X in bin/Strcfiles/* ; do
  echo 'doing $X'
  SY=${X##*/}    # strip directories
  SY=${SY%.strc} # strip extension
  sy=$( echo "$SY" | tr -s '[:upper:]' '[:lower:]' )  #make lowercase
  PDIR=${CASESDIR}/${SY}
  if [[ ! -e $PDIR ]]; then mkdir ${PDIR}; fi
  TMPFILE=$(mktemp ${TMPDIR}/tmp.XXXXXX)
  if [[ ! -f ${SPECIESDIR}/${sy}.species ]] ; then
    echo "error in $0: species file not present"
    exit 1
  fi
  paw_resolve -f $SY.species=${SPECIESDIR}/${sy}.species \
              ${STRCDIR}/${SY}.strc | \
              tr '[a-z]' '[A-Z]' | \
              sed -e s/ORBPOT_X/ORBPOT/g \
                  -e s/R=50./R=80./g \
              >${PDIR}/${SY}.strc
  cp bin/sample.cntl ${PDIR}/${SY}.cntl
  cd ${PDIR}
  # remark paw_waittillempty is called inside paw_scanlat
  paw_scanlat -p ${SY} -l "99.02 99.35 98.68 99.01 99.34 99.67 100.00 100.33 100.66 100.99 101.32 101.65 101.98"
  cd $THISDIR
  echo '... $X done'
done
exit0
